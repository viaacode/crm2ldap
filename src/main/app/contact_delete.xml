<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw" xmlns:validation="http://www.mulesoft.org/schema/mule/validation" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-current.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/dw http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
http://www.mulesoft.org/schema/mule/validation http://www.mulesoft.org/schema/mule/validation/current/mule-validation.xsd">
    <sub-flow name="contact_delete">
        <logger message="CONTACT DELETE GET #[payload]" level="INFO" doc:name="Logger"/>
        <set-variable variableName="contact_id" value="#[message.inboundProperties.'http.query.params'.get(&quot;id&quot;)]" doc:name="Set  contact_id"/>
        <flow-ref name="get_contact" doc:name="Get Contact"/>
        <set-variable variableName="state" value="GET_CONTACT" doc:name="Variable - state"/>
        <flow-ref name="log_elastic_search" doc:name="eSearch"/>
        <set-variable variableName="contact_uuid" value="#[contact.custom_fields[dw(&quot;p('teamleader.custom_field.contact.user_id')&quot;)]]" doc:name="Variable - contact_uuid"/>
        <validation:is-not-empty config-ref="Validation_Configuration" message="Contact #[flowVars.contact_id] has no LDAP UUID - 3 LDAP User ID Field" value="#[flowVars.contact_uuid]" doc:name="Validation UUID cannot be empty"/>
        <flow-ref name="contact_get_by_uuid" doc:name="Get Contact by UUID"/>
        <flow-ref name="ldap_contact_delete" doc:name="LDAP Contact Delete"/>
        <set-variable variableName="result" value="Contact Deleted in LDAP" doc:name="Variable - result"/>
        <set-variable variableName="state" value="CONTACT_DELETED" doc:name="Variable - state"/>
        <flow-ref name="log_elastic_search" doc:name="eSearch"/>
    </sub-flow>
</mule>
